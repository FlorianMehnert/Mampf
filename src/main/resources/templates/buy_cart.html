<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <!-- Bootstrap -->
  <!-- CSS -->
  <link rel="icon" type="image/vnd.microsoft.icon" th:href="@{/resources/img/cook_icon.ico}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

  <script th:src="@{/webjars/jquery/jquery.min.js}" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <link rel="stylesheet" type="text/css" th:href="@{/resources/css/style.css}" />
  <!-- Bootstrap -->
  <!-- jQuery and JS bundle w/ Popper.js -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
    crossorigin="anonymous"></script>

  <title>Warenkorb</title>
</head>

<body>
	<nav th:include="navigation :: navigation"></nav>


	<form method="post" role="form" id="form" th:action="@{/checkout}" th:object="${form}">
	<div class="alert alert-danger alert-dismissible fade show" role="alert" th:if="${#fields.hasErrors('generalError')}">
		<strong>Bestellvorgang abgebrochen</strong>
		<span th:errors="*{generalError}"></span>
		<button type="button" class="close" data-dismiss="alert" aria-label="Close">
		<span aria-hidden="true">&times;</span>
		</button>

	</div>
	<div class="alert alert-danger alert-dismissible fade show" role="alert" th:if="${#fields.hasErrors()}">
      <strong>Bestellvorgang abgebrochen</strong>
      <span th:errors="*{allStartDates}"></span>
      <span th:errors="*{allStartTimes}"></span>
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
	<div class="container" th:each="domain : ${domains}">
		<div class="row">
			<br>
			<h3 th:text="${domain.key}"></h3>
			<table class="table table-hover">
				<thead class="thead-light">
					<tr>
					  <th>Titel</th>
					  <th>Anzahl</th>
					  <th>Preis</th>
					</tr>
				</thead>
				<tbody >
					<tr th:each="item : ${domain.value} ">
						<td th:text="${item.productName}"></td>
						<td th:text="${item.quantity.getAmount()}"></td>
						<td th:text="${{item.price}}"></td>
					</tr>
					<tr>
						<td><b>Summe</b></td>
						<td ></td>
						<td th:text="${{domain.value.price}}"></td>
					</tr>
				</tbody>
			</table>
		</div>
		<div class="form-group mt-2" th:with="hideForm=${form.domainsWithoutForm.contains('__${domain.key}__')}">
			<div th:text="${hideForm}"></div>
			<input type="hidden" th:name="${domain.key}" th:value="${domain.key}">
			<label for="startDate1" th:unless="${hideForm}">Datum:</label>
			<input id="startDate1" class="form-control" th:classappend="${#fields.hasErrors('allStartDates['+domain.key+']')} ? 'is-invalid' : ''"
				   th:type="${hideForm}? 'hidden' : 'date'" th:name="${'allStartDates['+domain.key+']'}" th:value="${form.getStartDate(domain.key)?.toString()}"/>
			<div class="invalid-feedback" th:if="${#fields.hasErrors('allStartDates['+domain.key+']')}" th:errors="*{allStartDates[__${domain.key}__]}">

			</div>
			<label for="startTime"  th:unless="${hideForm}">Uhrzeit:</label>
			<input id="startTime" class="form-control" th:if="${#maps.containsKey(form.allStartTimes, domain.key)}" th:classappend="${#fields.hasErrors('allStartTimes['+domain.key+']')} ? 'is-invalid' : ''"
			th:type="${hideForm}? 'hidden' : 'time'" th:field="*{allStartTimes[__${domain.key}__]}"/>
			<input id="startTime2" class="form-control" th:unless="${#maps.containsKey(form.allStartTimes, domain.key)}" th:classappend="${#fields.hasErrors('allStartTimes['+domain.key+']')} ? 'is-invalid' : ''"
			th:type="${hideForm}? 'hidden' : 'time'" th:name="${'allStartTimes['+ domain.key + ']'}" th:value="${form.getTimeNow()}"/>
			<div class="invalid-feedback" th:if="${#fields.hasErrors('allStartTimes['+domain.key+']')}" th:errors="*{allStartTimes[__${domain.key}__]}">
			
			</div>
		</div>
		<div class="form-group mt-2" >
			<div th:each="err : ${validations.get('__${domain.key}__')}">
			<div th:text="${err}" class="alert alert-danger alert-dismissible fade show" role="alert"></div>
			</div>
		</div> 
	</div>
	<hr><br>
	<div class="container">
		
		<div class="row mt-3">
			<b>Gesamtpreis:&nbsp </b><b th:text="${{total}}"></b>
		</div>
		<div class="row mt-3">
			<h4>Bestellung abschließen</h4>
		</div>
		<div class="row mt-3">
			<input type="hidden" name="domainChoosen" th:field="*{domainChoosen}" th:value="${domainChoosen}"/>
			<div class="form-check form-check-inline">
				<input id="barChecked" class="form-check-input" type="radio" name="payMethod" value="Bar" checked="checked" />
				<label for="barChecked" class="form-check-label">Bar</label>
			</div>
			<div class="form-check form-check-inline">
				<input id="checkChecked" class="form-check-input" type="radio" name="payMethod" value="Check" />
				<label for="checkChecked" class="form-check-label">Überweisung</label>
			</div>
			
		</div>
		<br/>
		<button type="submit" class="btn btn-outline-primary">Bestellung erstellen</button>
			
	</div>
	</form>

</body>

</html>